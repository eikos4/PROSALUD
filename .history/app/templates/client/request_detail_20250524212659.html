{% extends 'base.html' %}
{% block title %}Detalle de solicitud{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-10 px-4">
  <h2 class="text-3xl font-bold text-[#276EF1] mb-7 flex items-center gap-2">
    <i class="fas fa-handshake"></i> Detalle de solicitud
  </h2>
  <div class="bg-white rounded-xl shadow p-7 mb-6">
    <div class="mb-2">
      <span class="font-semibold text-[#164399]">Profesional:</span>
      {{ req.service.professional_user.full_name or req.service.professional_user.username }}
    </div>
    <div class="mb-2">
      <span class="font-semibold text-[#164399]">Servicio:</span>
      {{ req.service.title }}
      <div class="text-gray-600 text-sm">{{ req.service.description }}</div>
    </div>
    <div class="mb-2">
      <span class="font-semibold text-[#164399]">Estado:</span>
      {% if req.status == 'pending' %}
        <span class="inline-block px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-bold text-xs">Pendiente</span>
      {% elif req.status == 'accepted' %}
        <span class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full font-bold text-xs">Aceptada</span>
      {% elif req.status == 'rejected' %}
        <span class="inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full font-bold text-xs">Rechazada</span>
      {% elif req.status == 'completed' %}
        <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-bold text-xs">Completada</span>
      {% endif %}
    </div>
    <div>
      <span class="font-semibold text-[#164399]">Fecha de solicitud:</span>
      {{ req.date_requested.strftime('%d-%m-%Y %H:%M') }}
    </div>
  </div>
  <h3 class="text-xl font-bold text-[#FF8800] mb-3 flex items-center gap-2">
    <i class="fas fa-comments"></i> Conversación
  </h3>
  <div class="bg-[#f5f7fc] rounded-xl p-5 mb-6 max-h-72 overflow-y-auto">
    {% if messages %}
      {% for msg in messages %}
        <div class="mb-2 flex {% if msg.sender_id == current_user.id %}justify-end{% else %}justify-start{% endif %}">
          <div class="inline-block px-4 py-2 rounded-2xl shadow
            {% if msg.sender_id == current_user.id %}
              bg-[#276EF1] text-white
            {% else %}
              bg-white text-gray-800 border border-gray-200
            {% endif %}">
            <div class="text-sm">{{ msg.body }}</div>
            <div class="text-xs text-gray-400 mt-1 {% if msg.sender_id == current_user.id %}text-right{% endif %}">
              {{ msg.timestamp.strftime('%d-%m-%Y %H:%M') }}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="text-gray-500 text-center py-4">No hay mensajes aún.</div>
    {% endif %}
  </div>
  <form method="POST" class="bg-white rounded-xl shadow p-6 flex gap-3 items-end">
    {{ form.hidden_tag() }}
    <div class="flex-1">
      {{ form.body.label(class_="block text-gray-700 font-semibold mb-1") }}
      {{ form.body(class_="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] bg-white text-gray-900", rows="3", placeholder="Escribe tu mensaje...") }}
      {% if form.body.errors %}
        <div class="text-red-500 text-xs mt-1">{{ form.body.errors[0] }}</div>
      {% endif %}
    </div>
    <button type="submit" class="h-12 px-7 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded-lg font-bold shadow flex items-center gap-2">
      <i class="fas fa-paper-plane"></i> Enviar
    </button>
  </form>
  <div class="mt-6">
    <a href="{{ url_for('client.my_requests') }}"
       class="inline-block px-6 py-2 bg-[#276EF1] hover:bg-[#1E5BB8] text-white rounded-lg font-semibold transition mt-8">Volver a solicitudes</a>
  </div>
</div>
{% endblock %}
