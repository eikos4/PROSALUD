{% extends 'base.html' %}
{% block title %}Mis Servicios – PROSALUD{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-12 px-2 md:px-0">
  <!-- Cabecera -->
  <div class="flex items-center gap-3 mb-10 animate-fade-in">
    <div class="bg-[#276EF1]/10 text-[#276EF1] p-3 rounded-full shadow">
      <i class="fas fa-stethoscope text-xl"></i>
    </div>
    <h2 class="text-3xl font-bold text-[#164399] tracking-tight">
      Servicios que ofreces en <span class="text-[#276EF1]">PROSALUD</span>
    </h2>
  </div>

  <!-- Feedback / Alertas -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-6 space-y-2 animate-fade-in">
        {% for category, msg in messages %}
          <div class="rounded-xl px-4 py-3 text-center font-semibold shadow
            {% if category == 'success' %} bg-green-50 text-green-800 border-l-4 border-green-400
            {% elif category == 'warning' %} bg-yellow-50 text-yellow-800 border-l-4 border-yellow-400
            {% elif category == 'danger' %} bg-red-50 text-red-700 border-l-4 border-red-400
            {% else %} bg-blue-50 text-blue-700 border-l-4 border-blue-400
            {% endif %}">
            {{ msg }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Lista de servicios creados -->
  <div class="bg-gradient-to-br from-[#e6f3ff] via-[#f7fbff] to-[#e3f1fc] rounded-3xl shadow-xl border border-[#276EF1]/10 p-8 mb-12 animate-fade-in">
    <h3 class="text-2xl font-bold text-[#276EF1] flex items-center gap-2 mb-6">
      <i class="fas fa-list-ul"></i> Tus servicios actuales
    </h3>
    {% if services %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% for s in services %}
        <div class="bg-white rounded-2xl shadow-md p-6 border border-[#276EF1]/10 hover:shadow-2xl transition-shadow relative animate-fade-in-up">
          <!-- Tag de precio -->
          <span class="absolute right-5 top-5 px-3 py-1 rounded-xl bg-[#276EF1]/10 text-[#276EF1] font-bold text-xs shadow-md">
            ${{ "{:,.0f}".format(s.price) }} CLP
          </span>
          <div class="mb-3 flex items-center gap-3">
            <div class="bg-[#276EF1]/10 p-2 rounded-full">
              <i class="fas fa-briefcase-medical text-[#276EF1] text-lg"></i>
            </div>
            <span class="font-bold text-lg text-[#164399]">{{ s.title }}</span>
          </div>
          <p class="text-gray-700 mb-4 min-h-[48px]">{{ s.description|truncate(110) }}</p>
          <div class="flex gap-2">
            <a href="{{ url_for('professional.edit_service', service_id=s.id) }}"
               class="flex items-center gap-1 px-4 py-2 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded-lg font-bold text-xs shadow transition">
              <i class="fas fa-edit"></i> Editar
            </a>
            <form action="{{ url_for('professional.delete_service', service_id=s.id) }}" method="POST" onsubmit="return confirm('¿Estás seguro de eliminar este servicio?');">
              <button type="submit" class="flex items-center gap-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold text-xs shadow transition">
                <i class="fas fa-trash-alt"></i> Eliminar
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="flex flex-col items-center justify-center py-16 text-center">
        <i class="fas fa-heartbeat text-5xl text-[#276EF1] mb-4 animate-pulse"></i>
        <p class="text-xl text-gray-400">No has creado servicios todavía.<br>¡Agrega tu primer servicio!</p>
      </div>
    {% endif %}
  </div>

  <!-- Formulario de agregar servicio -->
  <div class="bg-white/90 rounded-3xl shadow-2xl border border-[#276EF1]/10 p-10 max-w-2xl mx-auto animate-fade-in-up mb-6">
    <h3 class="text-xl font-bold mb-6 text-[#276EF1] flex items-center gap-2">
      <i class="fas fa-plus-circle"></i> Crear un nuevo servicio
    </h3>
    <form method="POST" class="space-y-7">
      {{ form.hidden_tag() }}

      <!-- Título -->
      <div>
        {{ form.title.label(class_="block text-[#164399] mb-1 font-semibold") }}
        {{ form.title(
            class_="w-full px-5 py-3 rounded-xl border border-gray-300 bg-[#f8fbfd] text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#276EF1] focus:bg-[#e6eefa] transition text-lg",
            placeholder="Ejemplo: Consulta médica general"
        ) }}
        {% if form.title.errors %}
          <span class="text-red-500 text-xs">{{ form.title.errors[0] }}</span>
        {% endif %}
      </div>

      <!-- Descripción -->
      <div>
        {{ form.description.label(class_="block text-[#164399] mb-1 font-semibold") }}
        {{ form.description(
            class_="w-full px-5 py-3 rounded-xl border border-gray-300 bg-[#f8fbfd] text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#276EF1] focus:bg-[#e6eefa] transition text-lg",
            rows="5",
            placeholder="Describe tu servicio (mínimo 3 líneas)"
        ) }}
        {% if form.description.errors %}
          <span class="text-red-500 text-xs">{{ form.description.errors[0] }}</span>
        {% endif %}
      </div>

      <!-- Precio -->
      <div>
        {{ form.price.label(class_="block text-[#164399] mb-1 font-semibold") }}
        {{ form.price(
            class_="w-full px-5 py-3 rounded-xl border border-gray-300 bg-[#f8fbfd] text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#276EF1] focus:bg-[#e6eefa] transition text-lg",
            placeholder="Ej: 25000"
        ) }}
        {% if form.price.errors %}
          <span class="text-red-500 text-xs">{{ form.price.errors[0] }}</span>
        {% endif %}
      </div>

      <!-- Botón -->
      <div>
        <button type="submit"
                class="w-full py-3 bg-[#276EF1] hover:bg-[#164399] text-white rounded-xl font-bold text-lg shadow-lg transition flex items-center justify-center gap-2">
          <i class="fas fa-save"></i> Guardar servicio
        </button>
      </div>
    </form>
  </div>
</div>

<style>
@keyframes fade-in { from { opacity:0; } to { opacity:1; } }
@keyframes fade-in-up { from { opacity:0; transform: translateY(40px);} to { opacity:1; transform: translateY(0);} }
.animate-fade-in    { animation: fade-in 0.8s;}
.animate-fade-in-up { animation: fade-in-up 0.8s;}
</style>
{% endblock %}
