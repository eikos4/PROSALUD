{% extends 'base.html' %}
{% block title %}Historial de servicios – IndepWork{% endblock %}

{% block content %}
<section class="min-h-screen bg-gradient-to-b from-[#f5f7fc] to-[#e6eefa] py-12">
  <div class="max-w-5xl mx-auto px-2 md:px-4">
    <div class="bg-white/95 rounded-2xl shadow-2xl border border-[#276EF1]/10 px-6 py-8 animate-fade-in">
      <h2 class="text-3xl font-extrabold text-[#276EF1] mb-8 flex items-center gap-3">
        <i class="fas fa-history"></i>
        Historial de servicios prestados
      </h2>
      {% if servicios %}
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-[#e6eefa] text-sm rounded-xl overflow-hidden shadow-lg">
            <thead class="bg-[#f5f7fc] text-[#164399] sticky top-0 z-10">
              <tr>
                <th class="px-6 py-4 text-left font-bold">Cliente</th>
                <th class="px-6 py-4 text-left font-bold">Servicio</th>
                <th class="px-6 py-4 text-left font-bold">Fecha</th>
                <th class="px-6 py-4 text-left font-bold">Evaluación</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-[#f5f7fc] text-[#1E293B]">
              {% for item in servicios %}
              <tr class="hover:bg-[#eaf1fd] transition">
                <td class="px-6 py-4">
                  <div class="flex items-center gap-2">
                    <img src="{{ item.client.profile_image_url or url_for('static', filename='images/placeholder.png') }}" class="w-8 h-8 rounded-full border-2 border-[#276EF1]/30 shadow-sm" alt="Avatar cliente">
                    <span class="font-bold text-[#276EF1]">{{ item.client.full_name or item.client.username }}</span>
                  </div>
                </td>
                <td class="px-6 py-4 font-semibold text-[#164399] whitespace-nowrap">
                  <i class="fas fa-briefcase mr-1 text-[#276EF1]/60"></i>
                  {{ item.service.title }}
                </td>
                <td class="px-6 py-4 text-gray-700 whitespace-nowrap">
                  <i class="fas fa-calendar-alt text-gray-400 mr-1"></i>
                  {{ item.date_requested.strftime('%d-%m-%Y') }}
                </td>
                <td class="px-6 py-4">
                  {% if item.evaluation %}
                    <div class="flex items-center gap-2">
                      <span class="inline-flex items-center gap-1 text-yellow-500 font-bold">
                        <i class="fas fa-star"></i>
                        {{ item.evaluation.rating }}<span class="text-gray-400 text-xs">/5</span>
                      </span>
                      <span class="text-gray-600 italic text-sm truncate" title="{{ item.evaluation.comment }}">
                        <i class="fas fa-comment-alt text-[#FF8800] mr-1"></i>
                        {{ item.evaluation.comment[:40] }}{% if item.evaluation.comment|length > 40 %}...{% endif %}
                      </span>
                    </div>
                  {% else %}
                    <span class="inline-block px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-xs font-bold">Sin evaluación</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="bg-white rounded-2xl shadow p-12 text-center text-gray-400 mt-10 border border-[#276EF1]/10">
          <i class="fas fa-info-circle text-5xl mb-4 text-[#276EF1]"></i>
          <p class="text-2xl font-black mb-2 text-[#164399]">Aún no has completado servicios.</p>
          <p class="text-lg text-[#276EF1]">Los servicios que completes aparecerán aquí junto a sus evaluaciones.</p>
        </div>
      {% endif %}
    </div>
  </div>
</section>
<style>
  @keyframes fade-in { from { opacity: 0; transform: scale(0.96);} to { opacity: 1; transform: scale(1);} }
  .animate-fade-in { animation: fade-in 0.18s ease; }
  @media (max-width: 700px) {
    table thead { display: none; }
    table tbody tr { display: block; margin-bottom: 16px; border: 1px solid #eee; }
    table tbody td { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border: none; }
    table tbody td:before {
      font-weight: bold;
      min-width: 90px;
      color: #276EF1;
    }
    table tbody td:nth-child(1):before { content: "Cliente"; }
    table tbody td:nth-child(2):before { content: "Servicio"; }
    table tbody td:nth-child(3):before { content: "Fecha"; }
    table tbody td:nth-child(4):before { content: "Evaluación"; }
  }
</style>
{% endblock %}
