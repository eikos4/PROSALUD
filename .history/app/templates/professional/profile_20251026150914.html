{% extends 'base.html' %}
{% block title %}Editar Perfil Profesional{% endblock %}

{% block content %}
<section class="min-h-screen bg-gradient-to-br from-[#f5faff] via-[#eef6ff] to-[#f8fbff] py-16">
  <div class="max-w-5xl mx-auto px-4 space-y-10 animate-fade-in">

    <!-- ENCABEZADO Y GRUCOBOT -->
    <div class="bg-white shadow-lg rounded-3xl border border-[#276EF1]/10 p-8 relative overflow-hidden">
      <div class="flex flex-col md:flex-row items-center gap-8">
        <!-- Avatar Grucobot -->
        <div class="flex-shrink-0">
          <img src="{{ url_for('static', filename='images/sanibot.png') }}"
               alt="Grucobot"
               class="w-40 md:w-48 drop-shadow-2xl animate-bounce-slow">
        </div>
        <!-- Mensaje informativo -->
        <div class="flex-1">
          <h1 class="text-3xl font-extrabold text-[#164399] mb-3 flex items-center gap-2">
            <i class="fas fa-user-md text-[#FF8800]"></i> Validaci칩n profesional
          </h1>
          <p class="text-gray-700 leading-relaxed text-lg">
            游녦 Hola, soy <strong>Grucobot</strong>. Esta secci칩n te permite actualizar tu informaci칩n profesional y
            subir tu <strong>t칤tulo o certificado</strong> para validar tu perfil dentro del sistema <span class="text-[#276EF1] font-semibold">PROSALUD</span>.
          </p>
          <p class="mt-3 text-gray-600 text-sm italic">
            Estos datos son revisados por nuestro equipo para corroborar tu identidad y experiencia en el 치rea de la salud.
            Solo profesionales verificados aparecer치n en las b칰squedas de pacientes.
          </p>
        </div>
      </div>
    </div>

    <!-- FORMULARIO DE EDICI칍N -->
    <form method="POST" enctype="multipart/form-data"
          class="bg-white shadow-2xl rounded-3xl border border-[#276EF1]/10 overflow-hidden flex flex-col md:flex-row"
          autocomplete="off">
      {{ form.hidden_tag() }}

      <!-- LADO IZQUIERDO - FOTO -->
      <div class="md:w-5/12 bg-gradient-to-b from-[#f5faff] to-[#eaf2ff] flex flex-col items-center justify-center py-10 px-6">
        <div class="relative group mb-4">
          <div class="w-36 h-36 rounded-full bg-gray-200 border-4 border-[#276EF1]/20 shadow-lg overflow-hidden">
            <img id="avatar-preview"
                 src="{{ url_for('professional.uploaded_file', filename=current_user.profile_image) if current_user.profile_image else url_for('static', filename='images/placeholder.png') }}"
                 class="object-cover w-full h-full transition group-hover:scale-105"
                 alt="Foto de perfil actual">
          </div>
          <label for="profile_image"
                 class="absolute bottom-2 right-2 bg-[#276EF1] hover:bg-[#164399] text-white rounded-full p-2 cursor-pointer shadow-md transition"
                 title="Cambiar foto de perfil">
            <i class="fas fa-camera"></i>
          </label>
          {{ form.profile_image(class_="hidden", id="profile_image") }}
        </div>
        <h3 class="text-lg text-[#276EF1] font-bold text-center mb-1">{{ current_user.full_name or 'Tu Nombre' }}</h3>
        <p class="text-xs text-gray-400 mb-3 text-center">{{ current_user.email }}</p>

        <!-- CERTIFICADO -->
        <div class="w-full mt-4">
          <label class="block text-[#164399] font-bold mb-2">Subir t칤tulo o certificaci칩n</label>
          {{ form.certificate_file(class_='w-full file:mr-3 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[#276EF1]/10 file:text-[#276EF1] hover:file:bg-[#276EF1]/20 transition') }}
          {% if current_user.certificate_file %}
          <div class="mt-2 text-sm text-gray-600 flex items-center gap-2">
            <i class="fas fa-file-medical text-[#FF8800]"></i>
            <a href="{{ url_for('static', filename='uploads/certificates/' + current_user.certificate_file) }}"
               target="_blank" class="text-[#276EF1] underline font-semibold">
               Ver certificado actual
            </a>
          </div>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">Formatos permitidos: PDF, JPG, PNG (m치x 5 MB).</p>
        </div>
      </div>

      <!-- LADO DERECHO - FORMULARIO -->
      <div class="md:w-7/12 p-8 md:p-12 space-y-6">
        <h2 class="text-2xl font-extrabold text-[#164399] mb-6 flex items-center gap-2">
          <i class="fas fa-user-edit text-[#FF8800]"></i> Informaci칩n profesional
        </h2>

        <!-- DATOS B츼SICOS -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            {{ form.full_name.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.full_name(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='Ej: Dra. Antonia Escand칩n') }}
          </div>
          <div>
            {{ form.email.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.email(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='correo@ejemplo.com') }}
          </div>
          <div>
            {{ form.phone.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.phone(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='+56912345678') }}
          </div>
          <div>
            {{ form.website.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.website(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='https://linkedin.com/in/tu-perfil') }}
          </div>
        </div>

        <!-- PROFESI칍N -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-4">
          <div>
            {{ form.category.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.category(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900') }}
          </div>
          <div>
            {{ form.subcategory.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.subcategory(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='Ej: Pediatr칤a, Ginecolog칤a...') }}
          </div>
          <div class="md:col-span-2">
            {{ form.location.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.location(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='Ej: Santiago, Chile') }}
          </div>
          <div class="md:col-span-2">
            {{ form.description.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.description(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='Describe tus servicios, experiencia y 치rea de enfoque.') }}
          </div>
          <div class="md:col-span-2">
            {{ form.experience.label(class_='block text-[#164399] font-bold mb-1') }}
            {{ form.experience(class_='w-full mt-1 px-4 py-3 bg-[#f8fbff] border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#276EF1] text-gray-900', placeholder='Ej: 8 a침os en medicina familiar, diplomado en urgencias, etc.') }}
          </div>
        </div>

        <div class="pt-6 border-t border-[#276EF1]/20">
          <button type="submit"
                  class="w-full py-3 bg-[#FF8800] hover:bg-[#e87500] text-white font-bold rounded-xl shadow-md transition-all flex items-center justify-center gap-2">
            <i class="fas fa-save"></i> Guardar cambios
          </button>
        </div>
      </div>
    </form>
  </div>
</section>

<style>
  @keyframes fade-in {0%{opacity:0;transform:translateY(40px);}100%{opacity:1;transform:none;}}
  .animate-fade-in {animation: fade-in 1.2s cubic-bezier(.6,0,.4,1) forwards;}
  @keyframes bounce-slow {0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}
  .animate-bounce-slow {animation: bounce-slow 4s ease-in-out infinite;}
</style>

<script>
  // Preview de imagen de perfil
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('profile_image');
    const preview = document.getElementById('avatar-preview');
    if (input && preview) {
      input.addEventListener('change', (e) => {
        const [file] = input.files;
        if (file) preview.src = URL.createObjectURL(file);
      });
    }
  });
</script>
{% endblock %}
