{% extends 'base.html' %}
{% block title %}Historial de servicios – IndepWork{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-12 px-4 animate-fade-in">
  <h2 class="text-3xl font-black mb-8 flex items-center gap-3 text-[#276EF1]">
    <i class="fas fa-history"></i> Historial de servicios prestados
  </h2>

  {% if servicios %}
    <div class="overflow-x-auto bg-white rounded-2xl shadow-xl border border-[#276EF1]/10">
      <table class="min-w-full table-auto text-left">
        <thead class="bg-[#f5f7fc] sticky top-0 z-10">
          <tr>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Cliente</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Servicio</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Fecha</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Evaluación</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for item in servicios %}
          <tr class="hover:bg-[#f7fbff] transition group">
            <td class="px-5 py-4 flex items-center gap-2 text-[#1E293B] font-semibold whitespace-nowrap">
              <i class="fas fa-user-circle text-[#FF8800] text-lg"></i>
              {{ item.client.full_name or item.client.username }}
            </td>
            <td class="px-5 py-4 font-bold text-[#276EF1] whitespace-nowrap">
              <i class="fas fa-briefcase mr-1 text-[#276EF1]/60"></i>
              {{ item.service.title }}
            </td>
            <td class="px-5 py-4 text-gray-700 whitespace-nowrap">
              <i class="fas fa-calendar-alt text-gray-400 mr-1"></i>
              {{ item.date_requested.strftime('%d-%m-%Y') }}
            </td>
            <td class="px-5 py-4">
              {% if item.evaluation %}
                <div class="flex items-center gap-2">
                  <span class="inline-flex items-center gap-1 text-yellow-500 font-bold">
                    <i class="fas fa-star"></i>
                    {{ item.evaluation.rating }}<span class="text-gray-400 text-xs">/5</span>
                  </span>
                  <span class="text-gray-600 italic text-sm truncate" title="{{ item.evaluation.comment }}">
                    <i class="fas fa-comment-alt text-[#FF8800] mr-1"></i>
                    {{ item.evaluation.comment[:40] }}{% if item.evaluation.comment|length > 40 %}...{% endif %}
                  </span>
                </div>
              {% else %}
                <span class="inline-block px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-xs font-bold">Sin evaluación</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="bg-white rounded-2xl shadow p-12 text-center text-gray-400 mt-10">
      <i class="fas fa-info-circle text-5xl mb-4 text-[#276EF1]"></i>
      <p class="text-2xl font-black mb-2 text-[#164399]">Aún no has completado servicios.</p>
      <p class="text-lg text-gray-600">Los servicios que completes aparecerán aquí junto a sus evaluaciones.</p>
    </div>
  {% endif %}
</div>
<style>
  /* Responsive fix para móvil */
  @media (max-width: 700px) {
    table thead { display: none; }
    table tbody tr { display: block; margin-bottom: 16px; border: 1px solid #eee; }
    table tbody td { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border: none; }
    table tbody td:before {
      font-weight: bold;
      min-width: 90px;
      color: #276EF1;
    }
    table tbody td:nth-child(1):before { content: "Cliente"; }
    table tbody td:nth-child(2):before { content: "Servicio"; }
    table tbody td:nth-child(3):before { content: "Fecha"; }
    table tbody td:nth-child(4):before { content: "Evaluación"; }
  }
</style>
{% endblock %}
