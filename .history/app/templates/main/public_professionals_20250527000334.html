{% extends 'base.html' %}
{% block title %}Explora Profesionales – IndepWork{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-[#276EF1]/10 to-[#FF8800]/5 pb-16 pt-8 min-h-screen">

  <!-- HERO / TÍTULO PRINCIPAL -->
  <div class="max-w-5xl mx-auto px-4 mb-10 text-center">
    <h1 class="text-4xl md:text-5xl font-black tracking-tight text-[#23272F] mb-2">IndepWork</h1>
    <div class="text-xl md:text-2xl font-semibold text-[#164399] mb-3">
      Encuentra al profesional ideal para tu próximo proyecto.
    </div>
    <p class="text-gray-600 max-w-2xl mx-auto mb-6">Explora una red diversa de expertos verificados: desde abogados y diseñadores, hasta técnicos y asesores. Filtra por especialidad, ubicación y reputación. ¡Conecta, conversa y avanza tu idea hoy!</p>
  </div>

  <!-- FILTROS STICKY -->
  <div class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-gray-100 mb-8 py-4">
    <form method="GET" class="max-w-5xl mx-auto flex flex-col md:flex-row gap-3 md:gap-6 items-center px-4">
      <input name="q" type="text" class="w-full md:w-80 px-4 py-2 rounded-lg border border-[#276EF1]/30 focus:border-[#276EF1] focus:ring-1 focus:ring-[#276EF1] text-base" placeholder="Buscar por nombre, rubro, ciudad..." value="{{ request.args.get('q','') }}">
      <select name="category" class="w-full md:w-64 px-4 py-2 rounded-lg border border-gray-200 focus:border-[#FF8800] focus:ring-1 focus:ring-[#FF8800] text-base">
        <option value="">Todas las especialidades</option>
        {% for cat in categories %}
          <option value="{{ cat }}" {% if request.args.get('category')==cat %}selected{% endif %}>{{ cat|capitalize }}</option>
        {% endfor %}
      </select>
      <select name="city" class="w-full md:w-56 px-4 py-2 rounded-lg border border-gray-200 focus:border-[#276EF1] focus:ring-1 focus:ring-[#276EF1] text-base">
        <option value="">Todas las ciudades</option>
        {% for city in cities %}
          <option value="{{ city }}" {% if request.args.get('city')==city %}selected{% endif %}>{{ city|capitalize }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="px-6 py-2 bg-[#276EF1] hover:bg-[#1E5BB8] text-white rounded-xl font-bold shadow transition">Filtrar</button>
    </form>
  </div>

  <!-- LISTADO DE PROFESIONALES -->
  <div class="max-w-7xl mx-auto px-2 sm:px-4">
    <div class="grid gap-10 sm:grid-cols-2 xl:grid-cols-3">
      {% for prof in professionals %}
      <div class="bg-white rounded-3xl shadow-xl hover:shadow-2xl transition-all border border-[#276EF1]/10 flex flex-col p-7 group relative min-h-[430px] overflow-hidden">
        
        <!-- “Destacado” o Premium badge -->
        {% if prof.rating and prof.rating >= 4.8 %}
        <div class="absolute top-5 left-5 bg-gradient-to-r from-[#FF8800] to-[#FFB347] text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg z-10 animate-pulse flex items-center gap-1">
          <i class="fas fa-crown"></i> Destacado
        </div>
        {% endif %}
        
        <!-- Avatar y Estado -->
        <div class="flex flex-col items-center mb-2">
          <div class="relative w-24 h-24 rounded-full border-4 border-[#FF8800]/40 shadow-lg overflow-hidden bg-gray-50 flex items-center justify-center">
            <img src="{{ prof.profile_image_url or url_for('static', filename='images/placeholder.png') }}"
              class="object-cover w-full h-full group-hover:scale-110 transition duration-300"
              alt="{{ prof.full_name or prof.username or 'Profesional' }}">
            {% if prof.is_online %}
              <span class="absolute bottom-2 right-2 w-5 h-5 rounded-full border-2 border-white bg-green-400 ring ring-white shadow"></span>
            {% endif %}
          </div>
          <h3 class="mt-2 text-2xl font-extrabold text-[#164399] mb-1 truncate w-full text-center" title="{{ prof.full_name or prof.username }}">
            {{ prof.full_name or prof.username or 'Sin nombre' }}
          </h3>
          {% if prof.verified %}
            <span class="inline-flex items-center gap-1 bg-green-100 text-green-700 px-3 py-0.5 rounded-full text-xs font-bold shadow-sm mt-1">
              <i class="fas fa-check-circle"></i> Verificado IndepWork
            </span>
          {% endif %}
        </div>
        
        <!-- Especialidad, ciudad, años de experiencia -->
        <div class="flex flex-wrap justify-center gap-2 mb-2">
          <span class="inline-flex items-center px-2 py-0.5 bg-[#276EF1]/10 text-[#276EF1] rounded-full text-xs font-bold gap-1">
            <i class="fas fa-user-tag"></i> {{ prof.category|capitalize if prof.category else 'Sin especialidad' }}
          </span>
          {% if prof.city %}
          <span class="inline-flex items-center px-2 py-0.5 bg-gray-100 text-gray-500 rounded-full text-xs gap-1">
            <i class="fas fa-map-marker-alt"></i> {{ prof.city|capitalize }}
          </span>
          {% endif %}
          {% if prof.experience_years %}
          <span class="inline-flex items-center px-2 py-0.5 bg-yellow-50 text-yellow-800 rounded-full text-xs gap-1">
            <i class="fas fa-award"></i> {{ prof.experience_years }} años exp.
          </span>
          {% endif %}
        </div>
        
        <!-- Tags de especialidades adicionales (si existen) -->
        {% if prof.specialties %}
        <div class="flex flex-wrap justify-center gap-2 mb-2">
          {% for spec in prof.specialties %}
          <span class="px-2 py-0.5 rounded-full bg-[#FF8800]/20 text-[#FF8800] text-xs font-bold">
            {{ spec }}
          </span>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Descripción -->
        <p class="text-gray-600 text-sm text-center mb-4 min-h-[44px]">
          {{ prof.description[:110] if prof.description else 'Sin descripción' }}
          {% if prof.description and prof.description|length > 110 %}...{% endif %}
        </p>
        
        <!-- Reseñas / rating -->
        <div class="flex items-center justify-center gap-1 mb-3">
          {% if prof.rating %}
            {% for i in range(1,6) %}
              {% if prof.rating >= i %}
                <i class="fas fa-star text-yellow-400"></i>
              {% elif prof.rating > (i-1) %}
                <i class="fas fa-star-half-alt text-yellow-400"></i>
              {% else %}
                <i class="far fa-star text-gray-300"></i>
              {% endif %}
            {% endfor %}
            <span class="text-gray-600 ml-1 text-sm font-bold">({{ "%.1f"|format(prof.rating) }})</span>
          {% else %}
            <span class="text-gray-400 text-sm">Sin calificaciones aún</span>
          {% endif %}
        </div>
        
        <!-- Zona de acciones rápida sticky -->
        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-white via-white/90 to-white/10 pt-4 pb-5 px-4 flex flex-col gap-2 border-t border-[#276EF1]/10">
          <a href="{{ url_for('main.public_profile', id=prof.id) }}"
             class="w-full py-2 bg-[#276EF1] hover:bg-[#164399] text-white rounded-xl font-bold shadow transition group-hover:scale-105 text-center"
             title="Ver perfil completo de {{ prof.full_name or prof.username }}">
            <i class="fas fa-user"></i> Ver Perfil
          </a>
          {% if prof.services.count() > 0 %}
          <a href="{{ url_for('client.request_service', service_id=prof.services.first().id) }}"
             class="w-full py-2 bg-green-500 hover:bg-green-600 text-white rounded-xl font-bold shadow transition group-hover:scale-105 text-center"
             title="Solicitar el primer servicio disponible">
            <i class="fas fa-handshake"></i> Solicitar Servicio
          </a>
          <a href="{{ url_for('messages.chat', other_id=prof.id, service_id=prof.services.first().id) }}"
             class="w-full py-2 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded-xl font-bold shadow transition group-hover:scale-105 text-center"
             title="Chatear sobre {{ prof.services.first().title }}">
            <i class="fas fa-comment-dots"></i> Chatear
          </a>
          {% endif %}
        </div>
      </div>
      {% else %}
      <div class="col-span-full text-center py-16">
        <i class="fas fa-user-slash text-5xl text-gray-300 mb-4"></i>
        <p class="text-gray-600 text-xl">No hay profesionales aún.<br>¡Sé el primero en sumarte a IndepWork!</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
