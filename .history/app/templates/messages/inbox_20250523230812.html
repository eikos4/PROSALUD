{% extends 'base.html' %}
{% block title %}Mensajes – IndepWork{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-10">
  <h2 class="text-3xl font-bold text-[#276EF1] mb-8 flex items-center gap-2">
    <i class="fas fa-inbox"></i> Bandeja de Mensajes
  </h2>
  {% if convos %}
    <div class="bg-white rounded-2xl shadow divide-y divide-gray-100">
      {% for msg in convos %}
      {# Determina el "otro usuario" para la conversación #}
      {% set other = msg.sender if msg.sender_id != current_user.id else msg.receiver %}
      <a href="{{ url_for('messages.chat', other_id=other.id) }}"
         class="flex items-center px-6 py-4 hover:bg-[#e6f0fe] transition group gap-4">
        <!-- Avatar seguro -->
        <img src="{{ other.profile_image_url or url_for('static', filename='images/placeholder.png') }}"
             alt="Avatar" class="h-12 w-12 rounded-full border-2 border-[#FF8800]/30 object-cover shadow">
        <!-- Info -->
        <div class="flex-1 min-w-0">
          <div class="flex justify-between items-center mb-1">
            <span class="font-bold text-[#164399] text-lg truncate">
              {{ other.username }}
            </span>
            <span class="text-xs text-gray-400 whitespace-nowrap">
              {{ msg.timestamp.strftime('%d-%m-%Y %H:%M') }}
            </span>
          </div>
          <div class="text-gray-700 text-sm truncate flex items-center gap-1">
            {% if msg.sender_id == current_user.id %}
              <span class="text-gray-400 font-semibold">Tú:</span>
            {% endif %}
            {{ msg.body[:60] }}{% if msg.body|length > 60 %}...{% endif %}
            {# Badge si tienes lógica de "no leído": #}
            {# {% if not msg.seen and msg.sender_id != current_user.id %}
                <span class="ml-2 inline-block w-2 h-2 bg-[#276EF1] rounded-full"></span>
               {% endif %} #}
          </div>
        </div>
        <i class="fas fa-chevron-right text-[#276EF1] opacity-0 group-hover:opacity-100 transition"></i>
      </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="bg-white rounded-lg shadow p-10 text-center text-gray-400">
      <i class="fas fa-envelope-open-text text-5xl mb-4"></i>
      <p class="text-lg">¡No tienes conversaciones aún!</p>
      <p class="mt-2 text-sm">Comienza a chatear con profesionales o clientes desde sus perfiles.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
