{% extends 'base.html' %}
{% block title %}Mensajes – IndepWork{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-10">
  <h2 class="text-3xl font-bold text-[#276EF1] mb-8 flex items-center gap-2">
    <i class="fas fa-inbox"></i> Bandeja de Mensajes
  </h2>
  {% if convos %}
    <div class="bg-white rounded-2xl shadow divide-y divide-gray-100">
      {% for msg in convos %}
      <a href="{{ url_for('messages.chat', other_id=(msg.sender_id if msg.sender_id != current_user.id else msg.receiver_id)) }}"
         class="flex items-center px-6 py-4 hover:bg-[#f4f7fe] transition group gap-4">
        <!-- Avatar -->
        <img src="{{ msg.sender.profile_image_url if msg.sender_id != current_user.id else msg.receiver.profile_image_url or url_for('static', filename='images/placeholder.png') }}"
             alt="Avatar" class="h-12 w-12 rounded-full border-2 border-[#FF8800]/30 object-cover">
        <!-- Info -->
        <div class="flex-1 min-w-0">
          <div class="flex justify-between items-center">
            <span class="font-bold text-[#164399] text-lg truncate">
              {{ msg.sender.username if msg.sender_id != current_user.id else msg.receiver.username }}
            </span>
            <span class="text-xs text-gray-400">
              {{ msg.timestamp.strftime('%d-%m-%Y %H:%M') }}
            </span>
          </div>
          <div class="text-gray-700 text-sm truncate">
            {% if msg.sender_id == current_user.id %}
              <span class="text-gray-400">Tú: </span>
            {% endif %}
            {{ msg.body[:60] }}{% if msg.body|length > 60 %}...{% endif %}
          </div>
        </div>
        <i class="fas fa-chevron-right text-[#276EF1] opacity-0 group-hover:opacity-100 transition"></i>
      </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="bg-white rounded-lg shadow p-10 text-center text-gray-400">
      <i class="fas fa-envelope-open-text text-5xl mb-4"></i>
      <p class="text-lg">¡No tienes conversaciones aún!</p>
      <p class="mt-2 text-sm">Comienza a chatear con profesionales o clientes desde sus perfiles.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
