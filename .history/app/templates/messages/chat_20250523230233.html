{% extends 'base.html' %}
{% block title %}Chat con {{ other_user.username }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-8">
  <h2 class="text-2xl font-bold mb-6 text-[#276EF1] flex items-center gap-2">
    <i class="fas fa-comments"></i>
    Chat con {{ other_user.username }}
  </h2>
  <div class="bg-white rounded-lg p-5 shadow mb-6 min-h-[300px] max-h-[420px] overflow-y-auto">
    {% for msg in convo %}
      <div class="mb-2 flex {% if msg.sender_id == current_user.id %}justify-end{% else %}justify-start{% endif %}">
        <div class="inline-block px-4 py-2 rounded-full max-w-xs
            {% if msg.sender_id == current_user.id %}bg-[#276EF1] text-white{% else %}bg-gray-200 text-gray-800{% endif %}">
          <strong>
            {% if msg.sender_id == current_user.id %}TÃº{% else %}{{ other_user.username }}{% endif %}:
          </strong>
          {{ msg.body }}
        </div>
      </div>
      <div class="text-xs text-gray-400 {% if msg.sender_id == current_user.id %}text-right{% endif %} mb-2">
        {{ msg.timestamp.strftime('%d-%m-%Y %H:%M') }}
      </div>
    {% endfor %}
  </div>
  <form method="POST" class="flex gap-2">
    {{ form.hidden_tag() }}  <!-- CLAVE para CSRF -->
    {{ form.body(class_="flex-1 px-4 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-[#276EF1] bg-white text-gray-900", rows="2", placeholder="Escribe un mensaje...") }}
    {{ form.submit(class_="px-5 py-2 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded font-semibold") }}
  </form>
</div>
{% endblock %}
