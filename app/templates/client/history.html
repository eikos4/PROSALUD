{% extends 'base.html' %}
{% block title %}Historial de Servicios – IndepWork{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-12 px-4">
  <h2 class="text-3xl font-bold text-[#276EF1] mb-8 flex items-center gap-2">
    <i class="fas fa-history"></i> Historial de Servicios
  </h2>
  {% if servicios %}
    <div class="bg-white rounded-2xl shadow-xl overflow-x-auto">
      <table class="min-w-full table-auto text-left divide-y divide-gray-100">
        <thead class="bg-[#f5f7fc]">
          <tr>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Profesional</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Servicio</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Fecha</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm">Estado</th>
            <th class="px-5 py-4 text-[#164399] font-bold text-sm"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for s in servicios %}
          <tr class="hover:bg-[#f5f8ff]/60 transition">
            <td class="px-5 py-4 flex items-center gap-3">
              <img src="{{ s.professional.profile_image_url or url_for('static', filename='images/placeholder.png') }}"
                   alt="{{ s.professional.username }}"
                   class="h-10 w-10 rounded-full object-cover border-2 border-[#FF8800]/20" />
              <a href="{{ url_for('main.public_profile', id=s.professional.id) }}"
                 class="font-semibold text-[#164399] underline hover:text-[#276EF1]">
                {{ s.professional.full_name or s.professional.username }}
              </a>
            </td>
            <td class="px-5 py-4">{{ s.service.title }}</td>
            <td class="px-5 py-4">{{ s.date_requested.strftime('%d-%m-%Y') }}</td>
            <td class="px-5 py-4">
              {% if s.status == 'pending' %}
                <span class="inline-block px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-bold text-xs">Pendiente</span>
              {% elif s.status == 'accepted' %}
                <span class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full font-bold text-xs">Aceptado</span>
              {% elif s.status == 'rejected' %}
                <span class="inline-block px-3 py-1 bg-red-100 text-red-700 rounded-full font-bold text-xs">Rechazado</span>
              {% elif s.status == 'completed' %}
                <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-bold text-xs">Completado</span>
              {% endif %}
            </td>
            <td class="px-5 py-4">
              {% if s.status == 'completed' and not s.evaluated %}
                <a href="{{ url_for('client.evaluate', service_id=s.id) }}"
                   class="px-4 py-2 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded-lg text-xs font-bold shadow transition"
                   title="Evalúa este servicio">
                  <i class="fas fa-star"></i> Evaluar
                </a>
              {% elif s.evaluated %}
                <span class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs">Evaluado</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="bg-white rounded-2xl shadow p-12 text-center text-gray-400 mt-10">
      <i class="fas fa-history text-5xl mb-4 text-[#276EF1]"></i>
      <p class="text-2xl font-bold mb-2 text-[#164399]">¡Aún no tienes historial!</p>
      <p class="text-lg text-gray-600 mb-6">Cuando completes un servicio, aparecerá aquí tu historial y podrás dejar una evaluación.</p>
      <a href="{{ url_for('main.search') }}" class="inline-block mt-4 px-8 py-3 bg-[#FF8800] hover:bg-[#CC7700] text-white rounded-full font-semibold shadow transition">
        <i class="fas fa-user-friends mr-2"></i> Buscar profesionales
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
